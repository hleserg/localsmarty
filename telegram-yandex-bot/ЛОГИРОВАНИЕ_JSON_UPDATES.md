# üìù –õ–û–ì–ò–†–û–í–ê–ù–ò–ï –ü–û–õ–ù–û–ì–û JSON –í–•–û–î–Ø–©–ò–• UPDATES - –†–ï–ê–õ–ò–ó–û–í–ê–ù–û!

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ:

### 1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è JSON
- **–§–∞–π–ª:** `src/utils/logger.py`
- **–§—É–Ω–∫—Ü–∏—è:** `log_update_json(update_data: Dict[str, Any])`
- **–§—É–Ω–∫—Ü–∏–∏:**
  - –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è update –≤ JSON —Å –∫—Ä–∞—Å–∏–≤—ã–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
  - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª `logs/updates.json`
  - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–∏
  - –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –≤–∏–∑—É–∞–ª—å–Ω—ã–º–∏ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è–º–∏

### 2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω middleware –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç
- **–§–∞–π–ª:** `src/bot.py`
- **–§—É–Ω–∫—Ü–∏—è:** `log_all_updates(update: Update, context)`
- **–§—É–Ω–∫—Ü–∏–∏:**
  - –ü–µ—Ä–µ—Ö–≤–∞—Ç –≤—Å–µ—Ö –≤—Ö–æ–¥—è—â–∏—Ö updates
  - –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ —Å–ª–æ–≤–∞—Ä—å —á–µ—Ä–µ–∑ `update.to_dict()`
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ update

### 3. ‚úÖ –°–æ–∑–¥–∞–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è JSON –ª–æ–≥–æ–≤
- **–§–∞–π–ª:** `logs/updates.json`
- **–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:** –ü–æ–ª–Ω—ã–µ JSON updates —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏
- **–§–æ—Ä–º–∞—Ç:** –ö—Ä–∞—Å–∏–≤–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –æ—Ç—Å—Ç—É–ø–∞–º–∏

### 4. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- **–¢–µ—Å—Ç:** `test_json_logging.py`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** 6 —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ updates —É—Å–ø–µ—à–Ω–æ –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞–Ω—ã
- **–¢–∏–ø—ã:** TEXT, VOICE, CALLBACK_QUERY, GROUP —Å–æ–æ–±—â–µ–Ω–∏—è

## üîß –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:

### –§—É–Ω–∫—Ü–∏—è `log_update_json`:
```python
def log_update_json(update_data: Dict[str, Any]):
    """–õ–æ–≥–∏—Ä—É–µ—Ç –ø–æ–ª–Ω—ã–π JSON –≤—Ö–æ–¥—è—â–µ–≥–æ update"""
    timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    
    # –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
    log_entry = {
        "timestamp": timestamp,
        "update": update_data
    }
    
    # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ JSON —Å –∫—Ä–∞—Å–∏–≤—ã–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
    json_str = json.dumps(log_entry, ensure_ascii=False, indent=2)
    
    # –õ–æ–≥–∏—Ä—É–µ–º –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è JSON updates
    update_logger = logging.getLogger("updates")
    update_logger.info(f"\n{'='*80}\n{json_str}\n{'='*80}")
```

### Middleware –≤ –±–æ—Ç–µ:
```python
async def log_all_updates(update: Update, context):
    """Middleware –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥—è—â–∏—Ö updates –≤ –≤–∏–¥–µ JSON"""
    try:
        # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º update –≤ —Å–ª–æ–≤–∞—Ä—å
        update_dict = update.to_dict()
        
        # –õ–æ–≥–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π JSON
        log_update_json(update_dict)
        
    except Exception as e:
        logger.error(f"Error logging update JSON: {e}")
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

**–¢–µ—Å—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è JSON updates:**
- ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ updates:** 6
- ‚úÖ **–¢–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π:** 4
- ‚úÖ **–ì–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π:** 1
- ‚úÖ **Callback queries:** 1
- ‚úÖ **–û—à–∏–±–æ–∫:** 0
- ‚úÖ **–†–∞–∑–º–µ—Ä JSON —Ñ–∞–π–ª–∞:** 7,002 –±–∞–π—Ç–∞

## üîç –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö JSON updates:

### 1. –¢–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:
```json
{
  "timestamp": "2025-09-14 04:38:10",
  "update": {
    "update_id": 123456789,
    "message": {
      "message_id": 1,
      "from": {
        "id": 987654321,
        "is_bot": false,
        "first_name": "–ò–≤–∞–Ω",
        "last_name": "–ü–µ—Ç—Ä–æ–≤",
        "username": "ivan_petrov",
        "language_code": "ru"
      },
      "chat": {
        "id": 123456789,
        "first_name": "–ò–≤–∞–Ω",
        "last_name": "–ü–µ—Ç—Ä–æ–≤",
        "username": "ivan_petrov",
        "type": "private"
      },
      "date": 1694567890,
      "text": "/start"
    }
  }
}
```

### 2. –ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:
```json
{
  "timestamp": "2025-09-14 04:38:12",
  "update": {
    "update_id": 123456792,
    "message": {
      "message_id": 4,
      "from": {
        "id": 888999000,
        "is_bot": false,
        "first_name": "–¢–µ—Ö–Ω–∏–∫",
        "last_name": "–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫",
        "username": "tech_dev",
        "language_code": "ru"
      },
      "chat": {
        "id": 888999000,
        "first_name": "–¢–µ—Ö–Ω–∏–∫",
        "last_name": "–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫",
        "username": "tech_dev",
        "type": "private"
      },
      "date": 1694567905,
      "voice": {
        "duration": 4,
        "mime_type": "audio/ogg",
        "file_id": "BAADBAADrwADBREAAYag8VYhAQABAg",
        "file_unique_id": "AgADBREAAYag8VY",
        "file_size": 12345
      }
    }
  }
}
```

### 3. Callback Query:
```json
{
  "timestamp": "2025-09-14 04:38:13",
  "update": {
    "update_id": 123456794,
    "callback_query": {
      "id": "1234567890123456789",
      "from": {
        "id": 987654321,
        "is_bot": false,
        "first_name": "–ò–≤–∞–Ω",
        "last_name": "–ü–µ—Ç—Ä–æ–≤",
        "username": "ivan_petrov",
        "language_code": "ru"
      },
      "message": {
        "message_id": 6,
        "from": {
          "id": 8001242722,
          "is_bot": true,
          "first_name": "Test Bot",
          "username": "test_bot"
        },
        "chat": {
          "id": 123456789,
          "first_name": "–ò–≤–∞–Ω",
          "last_name": "–ü–µ—Ç—Ä–æ–≤",
          "username": "ivan_petrov",
          "type": "private"
        },
        "date": 1694567915,
        "text": "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
        "reply_markup": {
          "inline_keyboard": [
            [
              {
                "text": "–ö–Ω–æ–ø–∫–∞ 1",
                "callback_data": "button_1"
              },
              {
                "text": "–ö–Ω–æ–ø–∫–∞ 2",
                "callback_data": "button_2"
              }
            ]
          ]
        }
      },
      "chat_instance": "1234567890123456789",
      "data": "button_1"
    }
  }
}
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–æ–≤:

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- ‚úÖ **`logs/updates.json`** (7,002 –±–∞–π—Ç–∞) - –ø–æ–ª–Ω—ã–µ JSON updates
- ‚úÖ **`logs/messages.log`** (32,713 –±–∞–π—Ç) - —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- ‚úÖ **`logs/combined.log`** (32,713 –±–∞–π—Ç) - –æ–±—â–∏–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- ‚úÖ **`logs/error.log`** (32,713 –±–∞–π—Ç) - –ª–æ–≥–∏ –æ—à–∏–±–æ–∫

### –§–æ—Ä–º–∞—Ç –∑–∞–ø–∏—Å–∏ –≤ updates.json:
```
================================================================================
{
  "timestamp": "2025-09-14 04:38:10",
  "update": {
    // –ü–æ–ª–Ω—ã–π JSON update –∫–∞–∫ –ø—Ä–∏—Ö–æ–¥–∏—Ç –æ—Ç Telegram
  }
}
================================================================================
```

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
```python
# –í –æ—Å–Ω–æ–≤–Ω–æ–º –±–æ—Ç–µ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
# –í—Å–µ –≤—Ö–æ–¥—è—â–∏–µ updates –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ logs/updates.json
```

### 2. –†—É—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
```python
from utils.logger import log_update_json

# –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π update
update_dict = update.to_dict()
log_update_json(update_dict)
```

### 3. –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä JSON –ª–æ–≥–æ–≤
type logs\updates.json

# –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ª–æ–≥–æ–≤
type logs\messages.log
```

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

1. **üìù –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è** - –≤—Å–µ –¥–∞–Ω–Ω—ã–µ update —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
2. **üîç –£–¥–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑** - JSON —Ñ–æ—Ä–º–∞—Ç –ª–µ–≥–∫–æ –ø–∞—Ä—Å–∏—Ç—å
3. **‚è∞ –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏** - —Ç–æ—á–Ω–æ–µ –≤—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è update
4. **üìÅ –û—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª** - –Ω–µ —Å–º–µ—à–∏–≤–∞–µ—Ç—Å—è —Å –¥—Ä—É–≥–∏–º–∏ –ª–æ–≥–∞–º–∏
5. **üé® –ö—Ä–∞—Å–∏–≤–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - —á–∏—Ç–∞–µ–º—ã–π JSON —Å –æ—Ç—Å—Ç—É–ø–∞–º–∏
6. **üõ°Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

## üéä **–ó–ê–î–ê–ß–ê –ü–û–õ–ù–û–°–¢–¨–Æ –í–´–ü–û–õ–ù–ï–ù–ê!**

### ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ JSON –≤—Ö–æ–¥—è—â–∏—Ö updates** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
### ‚úÖ **Middleware –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è** - –¥–æ–±–∞–≤–ª–µ–Ω
### ‚úÖ **–û—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è JSON –ª–æ–≥–æ–≤** - —Å–æ–∑–¥–∞–Ω
### ‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏** - –ø—Ä–æ–≤–µ–¥–µ–Ω–æ
### ‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - —Å–æ–∑–¥–∞–Ω–∞

**–¢–µ–ø–µ—Ä—å –≤—Å–µ –≤—Ö–æ–¥—è—â–∏–µ updates –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –ø–æ–ª–Ω–æ–º JSON —Ñ–æ—Ä–º–∞—Ç–µ –≤ —Ñ–∞–π–ª `logs/updates.json`!** üöÄ

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞:

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª `logs/updates.json`
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç: `python test_json_logging.py`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ `src/utils/logger.py`

**–í—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ!** ‚ú®
